//>>built
define("epi/shell/widget/FormContainer",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-geometry","dojo/aspect","dojo/has","dojo/when","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Form","epi/epi","epi/string","require","epi/shell/widget/WidgetFactory","epi/shell/MetadataTransformer"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10){return _1([_8,_9,_a],{templateString:"<div class=\"epi-form-container\">                            <div data-dojo-type=\"dijit/form/Form\" data-dojo-attach-point=\"form\">                            </div>                         </div>",value:null,metadata:null,propertyFilter:null,defaultContainerWidget:"epi/shell/layout/SimpleContainer",useDefaultValue:null,readOnly:false,doLayout:true,_widgetMap:null,_uiSetUp:false,_aspectHandles:null,postMixInProperties:function(){this.inherited(arguments);this._widgetMap={};this._aspectHandles=[];},startup:function(){if(this._started){return;}this.inherited(arguments);this._setupUI();},destroy:function(_11){_2.forEach(this._aspectHandles,function(_12){_12.remove();});this._aspectHandles=null;if(this.containerLayout){this.containerLayout.destroyRecursive(_11);this.containerLayout=null;}this.inherited(arguments);},_getValueAttr:function(){return this.form.get("value");},_setValueAttr:function(_13){if(this._formCreated){if(_13){this.form.set("value",_13);}else{this.form.reset();}}this._set("value",_13);},_setMetadataAttr:function(_14){this._set("metadata",_14);},_getUseDefaultValueAttr:function(){if(this.useDefaultValue===null){return !this.value;}return this.useDefaultValue;},onGroupCreated:function(_15,_16){},onChange:function(_17){},onFieldCreated:function(_18,_19){},_onFormCreated:function(_1a){if(_c.isEmpty(this.get("value"))){this._onChange();}this.onFormCreated(_1a);},onFormCreated:function(_1b){},_setupUI:function(){var _1c=new _f();var _1d=this.metadataTransformer||new _10({propertyFilter:this.propertyFilter});_7(this.metadata,_3.hitch(this,function(_1e){if(false){var _1f=_e.timedGroup("FormContainer::_setupUI "+arguments.callee.caller.nom);}var _20=this.get("useDefaultValue");var _21=_1d.toComponentDefinitions(_1e,"",_20,this.readOnly);var _22=_1e.layoutType||this.defaultContainerWidget;require([_d.slashName(_22)],_3.hitch(this,function(_23){var _24=[],_25=[];this.containerLayout=new _23();_24.push(this.containerLayout);this.connect(_1c,"onWidgetCreated",function(_26,_27){var _28=_24[_24.length-1];var _29=_25.length?_25[_25.length-1]:null;this._widgetMap[_26.id]={parent:_28,group:_29};this.own(this.watch("readOnly",_3.hitch(this,function(_2a,_2b,_2c){_26.set("readOnly",_2c);})));if(_27.settings._type==="field"){_26.set("editMode","createcontent");this.connect(_26,"onChange","_onChange");this._aspectHandles.push(_5.before(_26,"focus",_3.hitch(this,function(){this._beforeSetFocus(_26);})));this.onFieldCreated(_27.settings.name,_26);}else{if(_27.settings._type==="group"){_25.push(_26);this.onGroupCreated(_27.settings.name,_26,_29);}else{if(_27.settings._type==="parent"){_24.push(_26);}}}});this.connect(_1c,"onWidgetHierarchyCreated",function(_2d,_2e){if(_2e.settings._type==="group"){_25.pop();}else{if(_2e.settings._type==="parent"){_24.pop();}}});_7(_1c.createWidgets(this.containerLayout,_21,false),_3.hitch(this,function(_2f){this.containerLayout.placeAt(this.form.domNode);this._formCreated=true;this.form.connectChildren();if(this.value!==null){this.set("value",this.value);}this.layout();this._uiSetUp=true;this._onFormCreated(this);_1c=null;_24=null;_25=null;if(false){_1f.end();}}));this.own(this.form.watch("state",_3.hitch(this,function(_30,_31,_32){this.set("state",_32);})));}));}));},_onChange:function(){if(!this._uiSetUp){return;}var _33=this.form.get("value");if(!_c.areEqual(this.value,_33)){this.value=_33;this.onChange(_33);}},focus:function(){},layout:function(){if(!this._started){return;}var _34=this.containerLayout;if(_34&&_34.resize){var _35=this._containerContentBox||this._contentBox;_34.resize(this.doLayout&&_35&&_35.w&&_35.h?_35:null);}},validate:function(){return this._uiSetUp&&this.form.validate();},isValid:function(){return this.validate();},_beforeSetFocus:function(_36){if(this._widgetMap[_36.id]){var _37=this._widgetMap[_36.id].parent;var _38=this._widgetMap[_36.id].group;this._beforeSetFocus(_37);if(_37.selectChild){_37.selectChild(_38);}}}});});