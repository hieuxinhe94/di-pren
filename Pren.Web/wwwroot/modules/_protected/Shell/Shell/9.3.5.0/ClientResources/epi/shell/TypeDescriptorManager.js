//>>built
define("epi/shell/TypeDescriptorManager",["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","epi/dependency","epi/i18n!epi/shell/ui/nls/contenttypes"],function(_1,_2,_3,_4,_5,_6,_7,_8){return {_uiDescriptors:{},resources:_8,store:null,initialize:function(){this.store=this.store||_7.resolve("epi.storeregistry").get("epi.shell.uidescriptor");return _6(this.store.query()).then(_4.hitch(this,function(_9){return this.registerTypeSettings(_9);}));},clear:function(){this._uiDescriptors={};},registerTypeSettings:function(_a){var _b=this._uiDescriptors={},_c=[];function _d(_e){if(_e&&!(_e instanceof Array)){_e=[_e];}return _e?_e.map(function(_f){return _10(_b[_f]);}):[];};function _10(_11){var _12=_11.descriptor,_13=_12.baseTypes||_12.baseTypeIdentifier;return _11.ctor||_5(_d(_13)).then(function(_14){_11.ctor=_3(_14,_12);_11.instance=new _11.ctor();return _11.ctor;});};_a.forEach(_4.hitch(this,function(_15){this._prepareDescriptor(_15);_b[_15.typeIdentifier]={instance:null,ctor:null,descriptor:_15};}));Object.keys(_b).forEach(function(key){var _16=_b[key];_c.push(_10(_16));});return _5(_c).then(function(){return true;});},registerTypeSetting:function(_17,_18){_18.typeIdentifier=_17;this.registerTypeSettings([_18]);},getValue:function(_19,_1a){var _1b=this._uiDescriptors[_19];return _1b?_1b.instance[_1a]:undefined;},getResourceValue:function(_1c,_1d,_1e){var _1f=this._uiDescriptors[_1c];return _1f?_1f.instance.getResource(_1d,_1e):undefined;},getAndConcatenateValues:function(_20,_21){var _22=[],_23=this._uiDescriptors[_20];_23&&_23.instance.getRecursive(_21,_22);return _22;},getInheritanceChain:function(_24){var _25=[],_26=this._uiDescriptors[_24];if(!_26){return _25;}_26.instance.constructor._meta.bases.forEach(function(_27){_25.push(_27._meta.hidden.typeIdentifier);});return _25;},isBaseTypeIdentifier:function(_28,_29){_28=this._uiDescriptors[_28];_29=this._uiDescriptors[_29];if(!_28||!_29){return false;}return _28.instance.isInstanceOf(_29.ctor);},removeIntersectingTypes:function(_2a,_2b){var _2c=[];if(_2a){_2a.forEach(function(_2d){if(_2.indexOf(_2b,_2d)===-1&&_2.some(_2b,function(_2e){return this.isBaseTypeIdentifier(_2d,_2e);},this)===false){_2c.push(_2d);}},this);}return _2c;},getValidAcceptedTypes:function(_2f,_30,_31){var _32=_30||[];var _33=_31||[];var _34=_2f||[];if(_32.length===0&&_33.length===0){return _34;}var _35=function(_36,_37){return _2.some(_37,function(_38){return this.isBaseTypeIdentifier(_36,_38);},this);};var _39=_2.filter(_34,function(_3a){return (!(_35.call(this,_3a,_33))&&_35.call(this,_3a,_32));},this);return _39;},_prepareDescriptor:function(_3b){var _3c,_3d=_3b.languageKey;Object.keys(_3b).forEach(function(key){var _3e=_3b[key];if(_3e===null||_3e===undefined){delete _3b[key];}});if(_3d){_3c=this.resources[_3d];}_4.mixin(_3b,{getRecursive:function(key,_3f){var _40=_3b[key];if(_40){if(_40 instanceof Array){_40.forEach(function(v){_3f.push(v);});}else{_3f.push(_40);}}this.inherited(arguments);},getResource:function(key,_41){var _42=_3b.resource,_3c;if(_42){if(!_41||(_41&&_3b.isPrimaryType)){_3c=_4.getObject(key,false,_42);if(_3c!==undefined){return _3c;}}}return this.inherited(arguments);},resource:_3c});}};});